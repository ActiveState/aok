require "rspec/core/rake_task"

RSpec::Core::RakeTask.new(:spec)

task :default => :spec

desc "Parse UAA Spring Security XML config and output our YAML format"
task :parse do
  require 'nokogiri'
  require 'yaml'
  require_relative 'lib/uaa_spring_security_utils'
  files = ['../../../uaa/uaa/src/main/webapp/WEB-INF/spring-servlet.xml']
  paths = files.collect{|f|File.join(File.dirname(File.expand_path(__FILE__)), f)}
  puts '# GENERATED FILE - DO NOT EDIT.'
  puts '# GENERATED BY ' + UaaSpringSecurityUtils::ConfigParser.name
  puts "# Config files from: #{files}"
  parser = UaaSpringSecurityUtils::ConfigParser.new(paths)
  parser.parse
  puts parser.to_yaml
end

#!/usr/bin/env ruby
puts "aok starting up at #{Time.now}"

require 'thin'
require 'kato/local/node'

app = Rack::Adapter.load(File.join(File.dirname(__FILE__), '..', 'config.ru'))
bind_address = Kato::Local::Node.get_local_node_id
server = Thin::Server.new(bind_address, AppConfig[:port])

ENV['RACK_ENV'] = 'production'
server.app = app
# The routers proxying to us handle killing inactive connections. Set an upper limit
# just to be safe.
server.timeout = 15 * 60 # 15 min
server.start
